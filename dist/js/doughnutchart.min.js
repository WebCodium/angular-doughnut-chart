angular.module("angular-doughnut-chart",[]).directive("doughnutChart",["$animateCss","$interval","$timeout",function(e,t,n){"use strict";var r={stroke:14},a={index:0,isSupported:!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),getPercent:function(e,t){return(100-e)*t/100},getLengthCircle:function(e){return Math.floor(2*Math.PI*e)},setCircleAttrs:function(e,t){return{r:e,cx:-(e+t/2),cy:e+t/2}},getClass:function(){return"doughnut-chart-"+this.index++}},c={restrict:"E",scope:{percentage:"=",stroke:"="}};return a.isSupported?angular.extend(c,{link:function(n,c){function s(){n.oldPecentage=n.oldPecentage||0,n.curPercent=n.oldPecentage;var r=n.percentage-n.oldPecentage;n.curPercent+=r>0?1:-1,n.intervalText=t(function(){n.curPercent+=r>0?1:-1,n.curPercent===n.percentage&&t.cancel(n.intervalText)},1e3/Math.abs(r)),e(c.find("circle").eq(1),{to:{"stroke-dashoffset":a.getPercent(n.percentage,n.length)}}).start()}function i(){n.animate=!0,e(c.find("circle").eq(1),{addClass:"doughnut-allow-animation"}).start().then(s)}function o(t){n.radius=(document.querySelectorAll("."+n["class"])[0].offsetWidth-n.stroke)/2,n.length=a.getLengthCircle(n.radius),e(c.find("circle").eq(1),{to:{"stroke-dashoffset":n.length}}).start().then(function(){n.drawed=!0,n.circles=c.find("circle").attr(a.setCircleAttrs(n.radius,n.stroke)),t&&(n.circles.eq(1).removeClass("doughnut-allow-animation"),s()),n.percentage&&!n.animate&&i()})}n.stroke=n.stroke||r.stroke,n["class"]=a.getClass(),e(c.children(),{addClass:n["class"]}).start().then(o),n.$watch("percentage",function(e,t){e!==t&&(n.percentage=e,n.oldPecentage=t,n.animate?(n.circles.eq(1).addClass("doughnut-allow-animation"),s()):n.drawed&&i())}),angular.element(window).on("resize",function(){o(!0)})},template:'<div class="doughnut-chart-wrapper"><div class="dough-text-suffix"><span class="dough-text">{{curPercent}}</span><sup class="dough-suffix">%</sup></div><svg xmlns="http://www.w3.org/2000/svg"><circle fill="none" class="circle-bg" stroke-width="{{stroke}}"/><circle fill="none" class="circle-animation" stroke-width="{{stroke}}" style="stroke-dasharray: {{length}};"/></svg></div>'}):angular.extend(c,{template:'<div class="doughnut-chart-wrapper">Not supported</div>'})}]);